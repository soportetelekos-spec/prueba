<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Propuesta Cliente - Telekos</title>
  <style>
    :root {
      --fondo: #f4f6f8;
      --texto: #0c4a75;
      --primario: #116cad;
      --secundario: #f58220;
      --panel: #fff;
      --sombra: rgba(0, 0, 0, 0.1);
      --total-fondo: #f2f6ff;
      --total-texto: #0c4a75;
      --total-general-fondo: #dfefff;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--fondo);
      color: var(--texto);
      margin: 0;
      padding: 0;
      transition: background 0.4s ease, color 0.4s ease;
    }

    /* CABECERA */
    .cabecera {
      background: var(--panel);
      border-bottom: 3px solid var(--primario);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      position: relative;
    }

    .cabecera img {
      width: 950px;
      height: auto;
      border-radius: 10px 10px 0 0;
      object-fit: contain;
    }

    /* SWITCH MODO OSCURO */
    .switch-container {
      position: absolute;
      right: 30px;
      top: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .switch-label {
      font-size: 14px;
      color: var(--texto);
      font-weight: 600;
    }

    .switch {
      position: relative;
      width: 52px;
      height: 30px;
    }

    .switch input { opacity: 0; width: 0; height: 0; }

    .slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: #ccc;
      border-radius: 34px;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: #3b82f6;
      box-shadow: 0 0 10px rgba(59,130,246,0.4);
    }

    input:checked + .slider:before {
      transform: translateX(22px);
    }

    /* CONTENIDO */
    .oferta {
      width: 950px;
      background: var(--panel);
      margin: 0 auto;
      padding: 40px;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 12px var(--sombra);
      box-sizing: border-box;
      transition: background 0.4s ease, color 0.4s ease;
    }

    h1 { color: var(--texto); margin-top: 0; }
    h2 { color: var(--secundario); border-bottom: 2px solid var(--secundario); padding-bottom: 5px; }
    h3 {
      background: var(--secundario);
      color: #fff;
      padding: 8px 10px;
      border-radius: 6px;
      margin-top: 30px;
      font-size: 16px;
      text-transform: uppercase;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      border: 2px solid var(--secundario);
    }

    th, td {
      border: 1px solid #dce3ea;
      padding: 10px;
      text-align: center;
    }

    th { background: #f9fbfc; color: var(--texto); }

    tr.total-row {
      background: var(--total-fondo);
      font-weight: bold;
      color: var(--total-texto);
    }

    .general-total {
      background: var(--total-general-fondo);
      font-weight: bold;
      font-size: 18px;
      color: var(--texto);
      text-align: right;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid transparent;
    }

    /* PANEL DE REVISI√ìN */
    .panel-derecho {
      width: 950px;
      background: var(--panel);
      margin: 30px auto 0 auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--sombra);
      box-sizing: border-box;
    }

    .panel-derecho h2 {
      color: var(--texto);
      border-bottom: 2px solid var(--secundario);
      padding-bottom: 5px;
      text-align: center;
    }

    .panel-derecho textarea {
      width: 100%;
      height: 200px;
      resize: none;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 14px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 10px;
      box-sizing: border-box;
    }

    /* BOTONES */
    .contenedor-botones {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 40px auto 60px auto;
    }

    .contenedor-botones button {
      background-color: var(--primario);
      color: #fff;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      transition: background 0.2s ease, box-shadow 0.2s;
    }

    .contenedor-botones button:hover:not(:disabled) {
      background-color: #0c4a75;
      box-shadow: 0 0 10px var(--primario);
    }

    #btnAceptar { background: #4CAF50; }
    #btnAceptar:disabled { background: #a8d5a8; cursor: not-allowed; }
    #btnRevisar { background: #3b82f6; }
    #btnRevisar:disabled { background: #93c5fd; cursor: not-allowed; }
    #btnRechazar { background: #d9534f; }

    /* RESULTADO */
    .resultado {
      display: none;
      background: var(--panel);
      width: 700px;
      margin: 120px auto;
      padding: 50px;
      border-radius: 12px;
      box-shadow: 0 4px 15px var(--sombra);
      text-align: center;
    }

    .aceptada { color: #28a745; }
    .revisar { color: #3b82f6; }
    .rechazada { color: #d9534f; }

    #volver {
      margin-top: 30px;
      background: var(--primario);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #volver:hover { background: #0c4a75; }

    /* üåô MODO OSCURO AZUL ELEGANTE */
    body.dark {
      --fondo: #1e293b;
      --panel: #2b3648;
      --texto: #dbeafe;
      --primario: #2563eb;
      --secundario: #3b82f6;
      --sombra: rgba(0, 0, 0, 0.3);
      --total-fondo: #334155;
      --total-texto: #93c5fd;
      --total-general-fondo: #1e293b;
    }

    body.dark .general-total {
      border: 1px solid #3b82f6;
    }

    body.dark th {
      background: #3b4b5f;
      color: #dbeafe;
    }

    body.dark td {
      border-color: #475569;
      color: #e2e8f0;
    }

    body.dark .panel-derecho textarea {
      background: #3b4b5f;
      color: #fff;
      border-color: #64748b;
    }

    body.dark h3 {
      background: #2563eb;
      color: #fff;
    }

.comparativa-cliente {
  margin-top: 25px;
  border-radius: 10px;
  padding: 25px;
  background: var(--panel);
  box-shadow: 0 4px 10px var(--sombra);
}

.comparativa-cliente table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

.comparativa-cliente th,
.comparativa-cliente td {
  border: 1px solid #dce3ea;
  padding: 8px;
  text-align: center;
}

.comparativa-cliente h2 {
  color: var(--secundario);
  border-bottom: 2px solid var(--secundario);
  padding-bottom: 5px;
}


/* --- ESTILOS PARA IMPRESI√ìN / PDF --- */
@media print {
  /* Ocultar botones interactivos que no hacen falta en el PDF */
  .switch-container,
  #volver {
    display: none !important;
  }

  /* Centrar y mantener los botones visibles si quieres incluirlos */
  .contenedor-botones {
    display: flex !important;
    justify-content: center !important;
    gap: 20px !important;
    margin-top: 40px !important;
    page-break-inside: avoid !important;
  }

  .contenedor-botones button {
    background: #116cad !important;
    color: white !important;
    border: none !important;
    padding: 10px 20px !important;
    border-radius: 8px !important;
    font-size: 14px !important;
  }

  /* Evitar cortes de tablas o secciones */
  table, tr, td, th {
    page-break-inside: avoid !important;
  }

  .oferta,
  .panel-derecho,
  .comparativa-cliente,
  .general-total {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }

  /* Forzar salto de p√°gina limpio si no cabe */
  h3, h2 {
    page-break-after: avoid !important;
  }

  /* Margen de la hoja */
  @page {
    margin: 20mm;
  }
}

@media print {
  .contenedor-botones { display: none !important; }
}


  </style>
</head>
<body>

  <!-- CABECERA -->
  <div class="cabecera">
    <img src="cabezera.png" alt="Cabecera Telekos">

    <div class="switch-container">
      <span class="switch-label">Modo oscuro</span>
      <label class="switch">
        <input type="checkbox" id="modoOscuro">
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <div id="pantallaPropuesta">
    <div class="oferta">
      <h1>Propuesta Comercial</h1>
      <p><strong>Fecha:</strong> <span>30/10/2025</span></p>
      <p><strong>Empresa:</strong> <span>Cliente Ejemplo S.L.</span></p>

      <h2>Servicios incluidos</h2>
      <h3>PACK PBX (CENTRALITA)</h3>
      <table>
        <thead><tr><th>Servicio</th><th>Cantidad</th><th>Coste Unitario</th><th>Total</th></tr></thead>
        <tbody><tr><td>Extensiones</td><td>5</td><td>5.00‚Ç¨</td><td>25.00‚Ç¨</td></tr></tbody>
        <tfoot><tr class="total-row"><td colspan="3">TOTAL PBX</td><td>25.00‚Ç¨</td></tr></tfoot>
      </table>

      <h3>OTROS SERVICIOS</h3>
      <table>
        <thead><tr><th>Servicio</th><th>Cantidad</th><th>Coste Unitario</th><th>Total</th></tr></thead>
        <tbody><tr><td>TKM Fibra Plus</td><td>1</td><td>44.00‚Ç¨</td><td>44.00‚Ç¨</td></tr></tbody>
        <tfoot><tr class="total-row"><td colspan="3">TOTAL OTROS</td><td>44.00‚Ç¨</td></tr></tfoot>
      </table>

      <div class="general-total">TOTAL GENERAL: <span>69.00‚Ç¨</span></div>
    </div>

    <aside class="panel-derecho">
      <h2>Revisi√≥n / Comentarios</h2>
      <textarea id="comentario" placeholder="Escribe observaciones o motivos de revisi√≥n..."></textarea>
    </aside>

    <div class="contenedor-botones">
      <button id="btnDescargar">üìÑ Descargar PDF</button>
      <button id="btnAceptar">‚úÖ Aceptar</button>
      <button id="btnRevisar" disabled>üîÑ Revisar</button>
      <button id="btnRechazar">‚ùå Rechazar</button>
    </div>
  </div>

  <!-- RESULTADO -->
  <div id="pantallaResultado" class="resultado">
    <h1 id="tituloResultado"></h1>
    <p id="mensajeResultado"></p>
    <button id="volver">üîô Volver a la Propuesta</button>
  </div>

  <script>
    const comentario = document.getElementById("comentario");
    const btnAceptar = document.getElementById("btnAceptar");
    const btnRevisar = document.getElementById("btnRevisar");
    const btnRechazar = document.getElementById("btnRechazar");
    const pantallaPropuesta = document.getElementById("pantallaPropuesta");
    const pantallaResultado = document.getElementById("pantallaResultado");

    comentario.addEventListener("input", () => {
      const texto = comentario.value.trim();
      btnRevisar.disabled = texto.length === 0;
      btnAceptar.disabled = texto.length > 0;
    });

    document.getElementById("btnDescargar").addEventListener("click", () => window.print());

    function mostrarResultado(estado) {
      pantallaPropuesta.style.display = "none";
      pantallaResultado.style.display = "block";
      const titulo = document.getElementById("tituloResultado");
      const mensaje = document.getElementById("mensajeResultado");

      if (estado === "aceptada") {
        titulo.textContent = "‚úÖ Propuesta Aceptada";
        titulo.className = "aceptada";
        mensaje.textContent = "Gracias. La propuesta ha sido aceptada correctamente.";
      } else if (estado === "revisar") {
        titulo.textContent = "üîÑ Propuesta Enviada a Revisi√≥n";
        titulo.className = "revisar";
        mensaje.textContent = "Tu comentario ha sido enviado para revisi√≥n del comercial.";
      } else if (estado === "rechazada") {
        titulo.textContent = "‚ùå Propuesta Rechazada";
        titulo.className = "rechazada";
        mensaje.textContent = "La propuesta ha sido rechazada. Nos pondremos en contacto contigo.";
      }
    }

    btnAceptar.addEventListener("click", () => mostrarResultado("aceptada"));
    btnRevisar.addEventListener("click", () => {
      if (comentario.value.trim()) mostrarResultado("revisar");
      else alert("‚ö†Ô∏è Debes escribir un comentario para revisar.");
    });
    btnRechazar.addEventListener("click", () => mostrarResultado("rechazada"));

    document.getElementById("volver").addEventListener("click", () => {
      pantallaResultado.style.display = "none";
      pantallaPropuesta.style.display = "block";
      comentario.value = "";
      btnRevisar.disabled = true;
      btnAceptar.disabled = false;
    });

    // üåô MODO OSCURO CON PERSISTENCIA
    const switchOscuro = document.getElementById("modoOscuro");
    const guardado = localStorage.getItem("modoOscuro") === "true";
    if (guardado) {
      document.body.classList.add("dark");
      switchOscuro.checked = true;
    }

    switchOscuro.addEventListener("change", () => {
      document.body.classList.toggle("dark", switchOscuro.checked);
      localStorage.setItem("modoOscuro", switchOscuro.checked);
    });

// === CARGAR DATOS GUARDADOS DESDE LA OFERTA ===
document.addEventListener("DOMContentLoaded", () => {
  const datos = JSON.parse(localStorage.getItem("ofertaTelekos") || "{}");

  if (datos.empresa) {
    document.querySelector(".oferta span").textContent = datos.empresa;
  }

  if (datos.fecha) {
    document.querySelector(".oferta p span").textContent = datos.fecha;
  }

  // Insertar tabla comparativa si corresponde
  if (datos.mostrarComparativa && datos.comparativa?.length > 0) {
    const divComparativa = document.createElement("div");
    divComparativa.className = "oferta comparativa-cliente";
    divComparativa.innerHTML = `
      <h2>Comparativa de Ahorro</h2>
      <table>
        <thead>
          <tr>
            <th style="background:#f58220;color:white;">Servicio Actual</th>
            <th style="background:#b82319;color:white;">Gasto Actual (‚Ç¨)</th>
            <th style="background:#0c4a75;color:white;">Nuevo Servicio</th>
            <th style="background:#77b255;color:white;">Nuevo Gasto (‚Ç¨)</th>
          </tr>
        </thead>
        <tbody>
          ${datos.comparativa
            .map(c => `
              <tr>
                <td>${c.servicioActual || "-"}</td>
                <td>${parseFloat(c.gastoActual || 0).toFixed(2)}</td>
                <td>${c.nuevoServicio || "-"}</td>
                <td>${parseFloat(c.nuevoGasto || 0).toFixed(2)}</td>
              </tr>
            `)
            .join("")}
        </tbody>
      </table>

      <div class="general-total" style="margin-top:15px;">
        <strong>Ahorro mensual:</strong> ${datos.ahorroMensual || "0.00"} ‚Ç¨<br>
        <strong>Ahorro anual:</strong> ${datos.ahorroAnual || "0.00"} ‚Ç¨<br>
        <strong>Porcentaje de ahorro:</strong> ${datos.porcentajeAhorro || "0%"}
      </div>
    `;
    document.querySelector("#pantallaPropuesta").insertBefore(divComparativa, document.querySelector(".panel-derecho"));
  }
});
// === CARGAR DATOS GUARDADOS DESDE LA OFERTA ===
document.addEventListener("DOMContentLoaded", () => {
  const datos = JSON.parse(localStorage.getItem("ofertaTelekos") || "{}");

  if (!datos || Object.keys(datos).length === 0) return;

  // üè¢ Empresa y fecha
  const spanEmpresa = document.querySelector(".oferta p span");
  const spanFecha = document.querySelector(".oferta p strong + span, .oferta p span");
  if (spanEmpresa) spanEmpresa.textContent = datos.empresa || "Cliente";
  if (spanFecha) spanFecha.textContent = datos.fecha || new Date().toLocaleDateString();

  // üí∞ Reemplazar tabla de servicios
  const tablaPBX = document.querySelectorAll(".oferta table")[0];
  const tablaOtros = document.querySelectorAll(".oferta table")[1];
  const tbodyPBX = tablaPBX.querySelector("tbody");
  const tbodyOtros = tablaOtros.querySelector("tbody");

  tbodyPBX.innerHTML = "";
  tbodyOtros.innerHTML = "";

  // Clasificaci√≥n de servicios PBX vs Otros
  const pbxKeywords = [
    "numeracion", "numeraciones", "extensiones", "canal", "canales",
    "hardware", "software", "tp 100 nac", "tp 200 nac",
    "tp 500 nac", "tp 1000 nac", "tp 2000 nac"
  ];

  let totalPBX = 0;
  let totalOtros = 0;

  datos.servicios?.forEach(s => {
    const total = (parseFloat(s.coste || 0) * parseFloat(s.cantidad || 0)) || 0;
    const filaHTML = `
      <tr>
        <td>${s.servicio}</td>
        <td>${s.cantidad}</td>
        <td>${parseFloat(s.coste).toFixed(2)}‚Ç¨</td>
        <td>${total.toFixed(2)}‚Ç¨</td>
      </tr>
    `;

    if (pbxKeywords.some(k => s.servicio.toLowerCase().includes(k))) {
      tbodyPBX.insertAdjacentHTML("beforeend", filaHTML);
      totalPBX += total;
    } else {
      tbodyOtros.insertAdjacentHTML("beforeend", filaHTML);
      totalOtros += total;
    }
  });

  // Actualizar totales en las tablas
  tablaPBX.querySelector("tfoot td:last-child").textContent = totalPBX.toFixed(2) + "‚Ç¨";
  tablaOtros.querySelector("tfoot td:last-child").textContent = totalOtros.toFixed(2) + "‚Ç¨";

  const totalGeneral = totalPBX + totalOtros;

  // üîπ Actualizar el TOTAL GENERAL principal
  const totalGeneralEl = document.querySelector(".general-total span");
  if (totalGeneralEl) totalGeneralEl.textContent = totalGeneral.toFixed(2) + "‚Ç¨";
// === COMPARATIVA DE AHORRO (una sola tabla) ===
const divAnterior = document.querySelector(".comparativa-cliente");
if (divAnterior) divAnterior.remove(); // ‚úÖ evita duplicados si recargas varias veces

if (datos.mostrarComparativa && Array.isArray(datos.comparativa) && datos.comparativa.length > 0) {
  const divComparativa = document.createElement("div");
  divComparativa.className = "oferta comparativa-cliente";
  
  let filasHTML = "";
  datos.comparativa.forEach(c => {
    filasHTML += `
      <tr>
        <td>${c.servicioActual || "-"}</td>
        <td>${parseFloat(c.gastoActual || 0).toFixed(2)}</td>
        <td>${c.nuevoServicio || "-"}</td>
        <td>${parseFloat(c.nuevoGasto || 0).toFixed(2)}</td>
      </tr>
    `;
  });

  divComparativa.innerHTML = `
    <h2>Comparativa de Ahorro</h2>
    <table>
      <thead>
        <tr>
          <th style="background:#f58220;color:white;">Servicio Actual</th>
          <th style="background:#b82319;color:white;">Gasto Actual (‚Ç¨)</th>
          <th style="background:#0c4a75;color:white;">Nuevo Servicio</th>
          <th style="background:#77b255;color:white;">Nuevo Gasto (‚Ç¨)</th>
        </tr>
      </thead>
      <tbody>${filasHTML}</tbody>
    </table>

    <div class="general-total" style="margin-top:15px;">
      <strong>Ahorro mensual:</strong> ${datos.ahorroMensual || "0.00"} ‚Ç¨<br>
      <strong>Ahorro anual:</strong> ${datos.ahorroAnual || "0.00"} ‚Ç¨<br>
      <strong>Porcentaje de ahorro:</strong> ${datos.porcentajeAhorro || "0%"}
    </div>
  `;

  // Inserta justo antes del panel derecho
  document.querySelector("#pantallaPropuesta").insertBefore(
    divComparativa,
    document.querySelector(".panel-derecho")
  );
}


});


  </script>

</body>
</html>
