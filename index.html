
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Propuesta de Servicio - Telekos</title>

  <!-- ‚úÖ Librer√≠a Select2 (buscador dentro del select) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <style>
/* üåô MODO OSCURO TECNOL√ìGICO - TELEKOS 2025 */

/* --- VARIABLES DE COLOR --- */
:root {
  --fondo: #0e1621;
  --fondo-secundario: #1a2433;
  --fondo-terciario: #1f2c3c;
  --borde: #263445;
  --texto-principal: #e5eaf0;
  --texto-secundario: #b0bac5;
  --azul: #4da3ff;
  --azul-oscuro: #1e3a5f;
  --naranja: #ff8c42;
  --verde: #77dd77;
  --rojo: #ff5c5c;
  --sombra: 0 0 15px rgba(0, 0, 0, 0.6);
  --resalte: 0 0 10px rgba(77, 163, 255, 0.5);
}

/* --- BASE GENERAL --- */
body {
  background: var(--fondo);
  color: var(--texto-principal);
  font-family: "Inter", "Segoe UI", Roboto, sans-serif;
  margin: 0;
  padding: 0;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

h1, h2, h3, h4 {
  color: var(--azul);
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* --- BLOQUES PRINCIPALES --- */
.container, .page2, .footer-section, .comparativa, .comercial {
  background: var(--fondo-secundario);
  border: 1px solid var(--borde);
  border-radius: 14px;
  max-width: 900px;
  margin: 30px auto;
  box-shadow: var(--sombra);
  transition: all 0.3s ease;
}

.container:hover, .page2:hover, .comparativa:hover, .comercial:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 25px rgba(77,163,255,0.3);
}

/* --- HEADER --- */
header {
  background: linear-gradient(90deg, #102540, #193556);
  padding: 25px 30px;
  border-radius: 14px 14px 0 0;
}

header h2 {
  color: var(--naranja);
  margin-bottom: 8px;
  font-size: 22px;
}

header p {
  color: var(--texto-secundario);
  font-size: 14px;
}

/* --- FORMULARIO --- */
.form-section {
  display: flex;
  justify-content: space-between;
  padding: 25px 35px;
  background: var(--fondo-terciario);
  border-top: 1px solid var(--borde);
}

.form-left label {
  font-weight: 600;
  color: var(--azul);
  font-size: 13.5px;
}

.form-left input, .form-left select {
  width: 95%;
  padding: 8px 10px;
  border: 1px solid var(--borde);
  border-radius: 8px;
  background: #0c131d;
  color: var(--texto-principal);
  transition: all 0.2s ease;
}

.form-left input:focus, .form-left select:focus {
  border-color: var(--azul);
  box-shadow: var(--resalte);
  outline: none;
}

/* --- TARJETA DERECHA --- */
.form-right {
  width: 230px;
  background: linear-gradient(180deg, #14365c, #0c1d2d);
  color: white;
  border-radius: 10px;
  text-align: center;
  padding: 25px 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* --- BLOQUE COMERCIAL --- */
.comercial {
  display: flex;
  align-items: center;
  gap: 20px;
  background: #151e2a;
  padding: 25px;
}

.comercial-img {
  width: 90px;
  height: 90px;
  border-radius: 10px;
  background: #0c131d center/contain no-repeat;
  border: 2px solid var(--borde);
  box-shadow: var(--sombra);
}

.comercial-info label {
  color: var(--azul);
  font-size: 13px;
  font-weight: bold;
}

.comercial-info input {
  background: transparent;
  border: none;
  border-bottom: 2px solid var(--borde);
  color: var(--texto-principal);
  padding: 5px;
  transition: all 0.3s;
}

.comercial-info input:focus {
  border-color: var(--naranja);
  outline: none;
}

/* --- TABLA DE SERVICIOS --- */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  margin-top: 10px;
}

th {
  background: #162538;
  color: var(--azul);
  padding: 10px;
  border: 1px solid var(--borde);
  text-transform: uppercase;
}

th:first-child {
  background: #1d2e46;
  color: var(--naranja);
}

td {
  border: 1px solid var(--borde);
  text-align: center;
  padding: 8px;
  color: var(--texto-principal);
}

input[type="number"], input[type="text"], select {
  background: #101a28;
  color: var(--texto-principal);
  border: 1px solid var(--borde);
  border-radius: 6px;
  padding: 6px;
  width: 95%;
  transition: 0.2s;
}

input:focus, select:focus {
  border-color: var(--azul);
  box-shadow: var(--resalte);
}

/* --- BOTONES --- */
button {
  cursor: pointer;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  padding: 10px 18px;
  font-size: 14px;
  transition: all 0.25s ease;
  color: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 15px rgba(255,255,255,0.1);
}

.add { background: var(--azul); }
.remove { background: var(--naranja); }
.btn-final.verde { background: var(--verde); }
.btn-final.azul { background: var(--azul); }
.btn-final.rojo { background: var(--rojo); }

/* --- FOOTER --- */
.footer-container {
  display: flex;
  background: var(--fondo-terciario);
  border-top: 1px solid var(--borde);
  padding: 20px;
  gap: 15px;
}

.observaciones-box textarea {
  background: #0f1825;
  color: var(--texto-principal);
  border: 1px solid var(--borde);
  border-radius: 8px;
  padding: 10px;
  width: 100%;
  height: 100px;
  resize: vertical;
}

.observaciones-box textarea:focus {
  border-color: var(--naranja);
  box-shadow: 0 0 6px rgba(255, 140, 66, 0.4);
}

/* --- BLOQUE FIRMA --- */
.firma-box {
  background: #151f2d;
  border-top: 4px solid var(--azul);
  border-radius: 12px;
  margin-top: 25px;
  padding: 25px;
}

.firma-sello {
  border: 2px dashed var(--azul);
  border-radius: 12px;
  background: #0c131d;
  height: 90px;
  color: var(--azul);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  letter-spacing: 1px;
  transition: 0.3s;
}

.firma-sello:hover {
  border-color: var(--naranja);
  color: var(--naranja);
}

/* --- COMPARATIVA --- */
.comparativa {
  background: #151f2b;
  padding: 25px;
  border: 1px solid var(--borde);
}

.comparativa th.orange { background: #ff8c42; color: #fff; }
.comparativa th.blue { background: var(--azul); color: #fff; }
.comparativa th.red { background: var(--rojo); color: #fff; }
.comparativa th.green { background: var(--verde); color: #fff; }

.comparativa input {
  background: #0e1827;
  border: 1px solid var(--borde);
  color: var(--texto-principal);
  border-radius: 6px;
  padding: 6px;
}

.comparativa input:focus {
  border-color: var(--azul);
  box-shadow: var(--resalte);
}

/* --- BLOQUE FINAL --- */
.acciones-finales {
  background: #121c2a;
  border: 1px solid var(--borde);
  border-radius: 12px;
  padding: 25px;
  text-align: center;
  box-shadow: var(--sombra);
}

.acciones-finales textarea {
  width: 100%;
  border: 1.5px solid var(--borde);
  border-radius: 8px;
  padding: 10px;
  background: #0c131d;
  color: var(--texto-principal);
  resize: vertical;
}

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  .form-section, .footer-container {
    flex-direction: column;
  }

  .form-right, .comercial-img {
    width: 100%;
  }

  table {
    font-size: 12px;
    display: block;
    overflow-x: auto;
  }

  .botones, .botones-finales {
    flex-direction: column;
    gap: 10px;
  }
}
</style>

</head>
<body>
<form onsubmit="return false;">

  <!-- P√ÅGINA 1 -->
  <div class="container">
    <header>
      <h2>SERVICIOS</h2><br>
      <p>Centralita en la nube ‚Ä¢ SMS masivo ‚Ä¢ Telefon√≠a con operadores
    <br><br>Formulario de OFERTA
      </p>
      <div class="logos">
      </div>
    </header>

    <div class="form-section">
      <div class="form-left">
        <!-- FECHA DE LA OFERTA -->
<div class="fecha-oferta">
  <label>FECHA DE LA OFERTA:</label>
  <input type="date" id="fechaOferta">
</div>

        <h3><span style="color:#f58220;">PROPUESTA DE SERVICIO</h3>
     <label>NOMBRE DE LA EMPRESA:</label>
<input type="text" id="nombreEmpresa" >
  
      <!-- üè† DIRECCI√ìN COMPLETA -->
<div class="direccion-box" style="margin-top:20px; background:#f9fbfc; padding:15px; border:1px solid #dce3ea; border-radius:8px;">
  <h4 style="color:#0c4a75; margin-bottom:10px;">Direcci√≥n del Cliente</h4>

  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <div style="flex:1 1 200px;">
      <label style="color:#0c4a75; font-weight:bold;">Tipo de v√≠a:</label>
      <select id="tipoVia" name="tipoVia" style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
        <option value="">Selecciona tipo de v√≠a:</option>
        <option>Arroyo</option>
        <option>Avenida</option>
        <option>Barrio</option>
        <option>Bulevar</option>
        <option>Calle</option>
        <option>Callej√≥n</option>
        <option>Camino</option>
        <option>Camino alto</option>
        <option>Camino bajo</option>
        <option>Camino viejo</option>
        <option>Campillo</option>
        <option>Carrera</option>
        <option>Carretera</option>
        <option>Cerrillo</option>
        <option>Costanilla</option>
        <option>Cuesta</option>
        <option>Ensanche</option>
        <option>Extrarradio</option>
        <option>Glorieta</option>
        <option>Interior</option>
        <option>Pasadizo</option>
        <option>Pasaje</option>
        <option>Paseo</option>
        <option>Paseo alto</option>
        <option>Paseo bajo</option>
        <option>Plaza</option>
        <option>Pradera</option>
        <option>Pret√≠l</option>
        <option>Puente</option>
        <option>Punto kilom√©trico</option>
        <option>Rambla</option>
        <option>Ribera</option>
        <option>Ronda</option>
        <option>Street</option>
        <option>Traves√≠a</option>
        <option>Vereda</option>
      </select>
    </div>

    <div style="flex:2 1 300px;">
      <label style="color:#0c4a75; font-weight:bold;">Nombre de la Calle:</label>
      <input type="text" id="nombreVia"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:0.5 1 100px;">
      <label style="color:#0c4a75; font-weight:bold;">N¬∫:</label>
      <input type="text" id="numero"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:0.5 1 100px;">
      <label style="color:#0c4a75; font-weight:bold;">Piso:</label>
      <input type="text" id="piso"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:0.5 1 120px;">
      <label style="color:#0c4a75; font-weight:bold;">Puerta:</label>
      <input type="text" id="puerta"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:0.5 1 120px;">
      <label style="color:#0c4a75; font-weight:bold;">Bloque:</label>
      <input type="text" id="bloque"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:0.5 1 120px;">
      <label style="color:#0c4a75; font-weight:bold;">Escalera:</label>
      <input type="text" id="escalera"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:1 1 200px;">
      <label style="color:#0c4a75; font-weight:bold;">Municipio:</label>
      <input type="text" id="municipio"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:1 1 150px;">
      <label style="color:#0c4a75; font-weight:bold;">Provincia:</label>
      <input type="text" id="provincia"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:1 1 150px;">
      <label style="color:#0c4a75; font-weight:bold;">C.P.:</label>
      <input type="text" id="codigoPostal" style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>

    <div style="flex:1 1 150px;">
      <label style="color:#0c4a75; font-weight:bold;">CCAA:</label>
      <input type="text" id="ccaa"  style="width:100%; padding:6px; border:1px solid #cdd5df; border-radius:4px;">
    </div>
  </div>

  
</div>

       <label>NIF/CIF/NIE:</label><input type="text" />
        <label>TEL√âFONO:</label><input type="text" />
        <label>EMAIL:</label><input type="email" />
      </div>
      <div class="form-right">
        <img src="">
        <a href="https://www.telekos.com"></a>
      </div>
    </div>
  </div>

<div class="comercial">
  <div class="comercial-img"></div>
  <div class="comercial-info">
    <h4>SU COMERCIAL</h4>

    <label>NOMBRE Y APELLIDOS:</label>
    <input type="text" placeholder="Escribe el nombre...">

    <label>TEL√âFONO M√ìVIL:</label>
    <input type="text" placeholder="Ej: 600 123 456">

    <label>EMAIL:</label>
    <input type="email" placeholder="nombre@empresa.com">

    <label>TEL√âFONO FIJO:</label>
     <input type="number" placeholder="91 088 50 50">

  </div>
</div>

 <!-- P√ÅGINA 2 -->
<div class="page2">
  <table id="tablaServicios">
    <thead>
      <tr>
        <th>SERVICIO</th>
        <th>CANT.</th>
        <th>COSTE MENSUAL (‚Ç¨)</th>
        <th>TOTAL (‚Ç¨)</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td>
          <select class="servicioSelect">
            <option value="">-- Selecciona un servicio --</option>
            <option value="5">Numeraciones</option>
            <option value="5">Extensiones</option>
            <option value="2">Canales</option>
            <option value="5">Hardware</option>
            <option value="5">Software</option>
            <option value="19">TP 100 Nac</option>
            <option value="25">TP 200 Nac</option>
            <option value="32">TP 500 Nac</option>
            <option value="49">TP 1000 Nac</option>
            <option value="79">TP 2000 Nac</option>
            <option value="34">TKM Fibra</option>
            <option value="44">TKM Fibra Plus</option>
            <option value="54">TKM Fibra Premium</option>
            <option value="12">TKM Backup</option>
            <option value="4.92">TKM Movil 10 Gb</option>
            <option value="6.57">TKM Movil 40 Gb</option>
            <option value="8.22">TKM Movil 100 Gb</option>
            <option value="10.7">TKM Movil 250 Gb</option>
            <option value="16.49">TKM Movil Gb Ilimitados</option>
            <option value="24.95">TKL Fibra 600</option>
            <option value="24.95">TKL Fibra 1 Gb</option>
            <option value="1.28">TKL M2M 500 Mb</option>
            <option value="2.11">TKL M2M 2 Gb</option>
            <option value="2.93">TKL M2M 3 Gb + 150 Min</option>
            <option value="4.26">TKL Movil 5 Gb</option>
            <option value="6.74">TKL Movil 30 Gb acumulables</option>
            <option value="7.57">TKL Movil 60 Gb acumulables</option>
            <option value="9.22">TKL Movil 80 Gb acumulables</option>
            <option value="10.05">TKL Movil 120 Gb acumulables</option>
            <option value="13.36">TKM Movil 400 Gb</option>
            <option value="17.49">TKL Movil 600 Gb</option>
            <option value="21.62">TKL Movil Gb Ilimitados</option>
          </select>
        </td>
        <td><input type="number" min="0" class="cantidad" placeholder=" "></td>

        <td><input type="number" min="0" step="0.01" class="coste" placeholder="0.00"></td>
        <td class="total">0.00</td>
      </tr>
    </tbody>
    <tfoot>
  <tr>
    <td colspan="3" style="text-align:right; color:#0c4a75; font-weight:bold;">
      TOTAL CENTRALITA (PBX) (‚Ç¨)
    </td>
    <td id="totalPBX">0.00</td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:right; color:#f58220; font-weight:bold;">
      TOTAL OTROS SERVICIOS (‚Ç¨)
    </td>
    <td id="totalOtros">0.00</td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:right; font-weight:bold;">
      TOTAL GENERAL (‚Ç¨)
    </td>
    <td id="totalGeneral">0.00</td>
  </tr>
</tfoot>

  </table>

  <div class="botones">
  <button class="add" id="agregarPredefinido">üß© Agregar Servicio Predefinido</button>
  <button class="add" id="agregarPersonalizado" style="background:#f58220;">‚úèÔ∏è Agregar Servicio Personalizado</button>
  <button class="remove" id="eliminarFila">üóëÔ∏è Eliminar √öltimo</button>
</div>


  <!-- PIE -->
  <div class="footer-section">
    <div class="footer-container">
      <div class="observaciones-box">
        <div class="obs-header">OBSERVACIONES</div>
        <textarea></textarea>
      </div>
      <div class="costes-box">
        <div class="coste-item naranja">COSTE MENSUAL DEL SERVICIO</div>
        <input type="number" id="costeMensual" readonly>

        <div class="coste-item azul">IVA</div>
        <input type="number" id="ivaMensual" readonly>

        <div class="coste-item azul">COSTE MENSUAL IVA INCL.</div>
        <input type="number" id="mensualIVA" readonly>

        <div class="coste-item naranja">COSTE DE INSTALACI√ìN</div>
        <input type="number" id="instalacion" placeholder="0.00">

        <div class="coste-item azul">IVA</div>
        <input type="number" id="ivaInstalacion" readonly>

        <div class="coste-item azul">COSTE INSTALACI√ìN IVA INCL.</div>
        <input type="number" id="instalacionIVA" readonly>
      </div>
    </div>
<!-- PIE -->


    <div class="nota-final">
      Los servicios facturados por Telekos no implican compromisos de permanencia ni penalizaciones asociadas a nuestros clientes.
    </div>

    <div class="firma-box">
      <div class="firma-header">FIRMA DEL CLIENTE ACEPTANDO LA OFERTA:</div>
      <div class="firma-container">
        <div class="firma-datos">
          <label>CLIENTE:</label><input type="text"><br>
          <label>NOMBRE:</label><input type="text"><br>
          <label>DNI:</label><input type="text">
        </div>
        <div class="firma-sello">FIRMA Y SELLO</div>
      </div>
    </div>

  <!-- PIE -->


<!-- OPCI√ìN PARA MOSTRAR/OCULTAR COMPARATIVA -->
<div style="margin:30px auto;max-width:850px;background:#f9fbfc;border:1.5px solid #cdd5df;border-radius:8px;padding:15px;">
  <label style="color:#0c4a75;font-weight:bold;">
    <input type="checkbox" id="mostrarComparativa" checked style="margin-right:8px;">
    Incluir la comparativa de ahorro en la propuesta al cliente
  </label>
</div>

  <!-- COMPARATIVA DE AHORRO -->
  <div class="comparativa">
    <h3 style="text-align:center;color:#0c4a75;">COMPARATIVA DE AHORRO</h3>
    <table id="tablaAhorro">
      <thead>
        <tr>
          <th colspan="2" class="orange">SERVICIO / GASTO ACTUAL</th>
          <th colspan="2" class="blue">SERVICIO / NUEVO GASTO</th>
        </tr>
        <tr>
          <th class="orange">SERVICIO</th>
          <th class="red">GASTO ACTUAL</th>
          <th class="blue">SERVICIO</th>
          <th class="green">NUEVO GASTO</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" placeholder="Servicio..."></td>
          <td><input type="number" class="gastoActual" step="0.01"></td>
          <td><input type="text" placeholder="Nuevo servicio..."></td>
          <td><input type="number" class="nuevoGasto" step="0.01"></td>
        </tr>
      </tbody>
    </table>

<div class="botones-comp">
  <button class="add" id="agregarAhorro">‚ûï Agregar Fila</button>
  <button class="remove" id="eliminarAhorro">üóëÔ∏è Eliminar √öltimo</button>
</div>


    <div class="ahorro">
      <div class="campo">
        <label>AHORRO MENSUAL (‚Ç¨):</label>
        <input type="number" id="ahorroMensual" readonly>
        <label>AHORRO ANUAL (‚Ç¨):</label>
        <input type="number" id="ahorroAnual" readonly>
      </div>
      <div class="porcentaje" id="porcentajeAhorro">0%</div>
    </div>
  </div>

  <!-- üî∏ SECCI√ìN DE ACCIONES FINALES -->
<div class="acciones-finales">
  <h3 style="color:#0c4a75;text-align:center;">Acciones sobre la oferta</h3>

  <textarea id="comentariosRevision" placeholder="Escribe tus observaciones si deseas revisar la oferta..."></textarea>

  <div class="botones-finales">
    <button id="aceptarOferta" class="btn-final verde">‚úÖ Aceptar Oferta</button>
    <button id="revisarOferta" class="btn-final azul" disabled>üîç Revisar</button>
    <button id="rechazarOferta" class="btn-final rojo">‚ùå Rechazar</button>
  </div>
</div>

  </div>
</div>
</form>
  <script>
    // --- CALCULOS SERVICIOS ---
    const tabla = document.querySelector("#tablaServicios tbody");
    const totalGeneralEl = document.getElementById("totalGeneral");
    const costeMensual = document.getElementById("costeMensual");
    const ivaMensual = document.getElementById("ivaMensual");
    const mensualIVA = document.getElementById("mensualIVA");
    const instalacion = document.getElementById("instalacion");
    const ivaInstalacion = document.getElementById("ivaInstalacion");
    const instalacionIVA = document.getElementById("instalacionIVA");


    instalacion.addEventListener("input", actualizarTotales);
    tabla.addEventListener("input", e => {
      if (e.target.classList.contains("cantidad") || e.target.classList.contains("coste")) actualizarTotales();
    });

// --- BOT√ìN: AGREGAR SERVICIO PREDEFINIDO ---
document.getElementById("agregarPredefinido").addEventListener("click", () => {
  const fila = document.createElement("tr");
  fila.innerHTML = `
    <td>
      <select class="servicioSelect">
        <option value="">-- Selecciona un servicio --</option>
        <option value="5">Numeraciones</option>
        <option value="5">Extensiones</option>
        <option value="2">Canales</option>
        <option value="5">Hardware</option>
        <option value="5">Software</option>
        <option value="19">TP 100 Nac</option>
        <option value="25">TP 200 Nac</option>
        <option value="32">TP 500 Nac</option>
        <option value="49">TP 1000 Nac</option>
        <option value="79">TP 2000 Nac</option>
        <option value="34">TKM Fibra</option>
        <option value="44">TKM Fibra Plus</option>
        <option value="54">TKM Fibra Premium</option>
        <option value="12">TKM Backup</option>
        <option value="4.92">TKM Movil 10 Gb</option>
        <option value="6.57">TKM Movil 40 Gb</option>
        <option value="8.22">TKM Movil 100 Gb</option>
        <option value="10.7">TKM Movil 250 Gb</option>
        <option value="16.49">TKM Movil Gb Ilimitados</option>
        <option value="24.95">TKL Fibra 600</option>
        <option value="24.95">TKL Fibra 1 Gb</option>
        <option value="1.28">TKL M2M 500 Mb</option>
        <option value="2.11">TKL M2M 2 Gb</option>
        <option value="2.93">TKL M2M 3 Gb + 150 Min</option>
        <option value="4.26">TKL Movil 5 Gb</option>
        <option value="6.74">TKL Movil 30 Gb acumulables</option>
        <option value="7.57">TKL Movil 60 Gb acumulables</option>
        <option value="9.22">TKL Movil 80 Gb acumulables</option>
        <option value="10.05">TKL Movil 120 Gb acumulables</option>
        <option value="13.36">TKM Movil 400 Gb</option>
        <option value="17.49">TKL Movil 600 Gb</option>
        <option value="21.62">TKL Movil Gb Ilimitados</option>
      </select>
    </td>
    <td><input type="number" min="0" class="cantidad" placeholder=" "></td>
    <td><input type="number" min="0" step="0.01" class="coste" placeholder="0.00"></td>
    <td class="total">0.00</td>`;
  tabla.appendChild(fila);
});

// --- BOT√ìN: AGREGAR SERVICIO PERSONALIZADO ---
document.getElementById("agregarPersonalizado").addEventListener("click", (e) => {
  e.preventDefault(); // ‚õî evita que el formulario se env√≠e
  const fila = document.createElement("tr");
  fila.innerHTML = `
    <td><input type="text" class="servicioPersonalizado" placeholder="Escribe el servicio..."></td>
   <td><input type="number" min="0" class="cantidad" placeholder=" "></td>
   <td><input type="number" min="0" step="0.01" class="coste" placeholder="0.00"></td>
    <td class="total">0.00</td>`;
  tabla.appendChild(fila);
});

// --- BOT√ìN: ELIMINAR FILA ---
document.getElementById("eliminarFila").addEventListener("click", (e) => {
  e.preventDefault(); // ‚õî evita recargar o enviar formulario
  const filas = tabla.querySelectorAll("tr");
  if (filas.length > 1) filas[filas.length - 1].remove();
  actualizarTotales();
});

// --- AUTO RELLENO DE COSTE AL SELECCIONAR SERVICIO ---
// --- AUTO RELLENO DE COSTE AL SELECCIONAR SERVICIO ---
// --- AUTO RELLENO DE COSTE AL SELECCIONAR SERVICIO (COMPATIBLE CON SELECT2) ---
$(document).on('select2:select', '.servicioSelect', function (e) {
  const fila = this.closest("tr");
  const costeInput = fila.querySelector(".coste");
  const cantidadInput = fila.querySelector(".cantidad"); // ‚úÖ nuevo

  const valor = parseFloat(this.value) || 0;
  costeInput.value = valor.toFixed(2);
  actualizarTotales();

  // ‚úÖ Al seleccionar un servicio, enfoca autom√°ticamente la cantidad
  if (cantidadInput) {
    cantidadInput.focus();
  }
});



// --- ACTUALIZAR TOTAL AL CAMBIAR CANTIDAD O COSTE ---
tabla.addEventListener("input", e => {
  if (e.target.classList.contains("cantidad") || e.target.classList.contains("coste")) {
    actualizarTotales();
  }
});

// --- FUNCI√ìN PRINCIPAL DE C√ÅLCULOS ---
// --- FUNCI√ìN PRINCIPAL DE C√ÅLCULOS (MEJORADA CON SUBTOTALES) ---
function actualizarTotales() {
  let totalGeneral = 0;
  let totalPBX = 0;
  let totalOtros = 0;

  // Palabras clave que identifican servicios de centralita (PBX)
  const pbxKeywords = [
    "numeracion", "numeraciones", "extensiones", "canal", "canales",
    "hardware", "software",
    "tp 100 nac", "tp 200 nac", "tp 500 nac", "tp 1000 nac", "tp 2000 nac"
  ];

  tabla.querySelectorAll("tr").forEach(fila => {
    const servicioTexto =
      fila.querySelector(".servicioSelect")?.selectedOptions[0]?.text?.toLowerCase() ||
      fila.querySelector(".servicioPersonalizado")?.value?.toLowerCase() ||
      "";

    const cantidad = parseFloat(fila.querySelector(".cantidad")?.value) || 0;
    const coste = parseFloat(fila.querySelector(".coste")?.value) || 0;
    const total = cantidad * coste;

    // Muestra el total de cada fila
    fila.querySelector(".total").textContent = total.toFixed(2);

    // Suma al total general
    totalGeneral += total;

    // Clasifica seg√∫n el tipo de servicio
    if (pbxKeywords.some(keyword => servicioTexto.includes(keyword))) {
      totalPBX += total;
    } else {
      totalOtros += total;
    }
  });

  // üßÆ Actualizar los totales en pantalla
  const totalPBXEl = document.getElementById("totalPBX");
  const totalOtrosEl = document.getElementById("totalOtros");

  if (totalPBXEl) totalPBXEl.textContent = totalPBX.toFixed(2);
  if (totalOtrosEl) totalOtrosEl.textContent = totalOtros.toFixed(2);
  totalGeneralEl.textContent = totalGeneral.toFixed(2);

  // üßæ Calcular IVA y totales
  costeMensual.value = totalGeneral.toFixed(2);
  const iva = totalGeneral * 0.21;
  ivaMensual.value = iva.toFixed(2);
  mensualIVA.value = (totalGeneral + iva).toFixed(2);

  const inst = parseFloat(instalacion.value) || 0;
  ivaInstalacion.value = (inst * 0.21).toFixed(2);
  instalacionIVA.value = (inst * 1.21).toFixed(2);
}


// --- MOSTRAR CAMPO PERSONALIZADO SI SE ELIGE OPCI√ìN MANUAL ---
tabla.addEventListener("change", e => {
  if (e.target.classList.contains("servicioSelect")) {
    const fila = e.target.closest("tr");
    const inputPersonalizado = fila.querySelector(".servicioPersonalizado");
    const costeInput = fila.querySelector(".coste");

    if (e.target.value === "personalizado") {
      inputPersonalizado.style.display = "block";
      costeInput.value = "";
      inputPersonalizado.focus();
    } else {
      inputPersonalizado.style.display = "none";
    }
  }
});


  // --- CALCULOS COMPARATIVA DE AHORRO ---
const tablaAhorro = document.querySelector("#tablaAhorro tbody");
const ahorroMensual = document.getElementById("ahorroMensual");
const ahorroAnual = document.getElementById("ahorroAnual");
const porcentajeAhorro = document.getElementById("porcentajeAhorro");

function actualizarAhorro() {
  let gastoActual = 0;
  let nuevoGasto = 0;

  tablaAhorro.querySelectorAll("tr").forEach(fila => {
    const actual = parseFloat(fila.querySelector(".gastoActual")?.value) || 0;
    const nuevo = parseFloat(fila.querySelector(".nuevoGasto")?.value) || 0;
    gastoActual += actual;
    nuevoGasto += nuevo;
  });

  const ahorro = gastoActual - nuevoGasto;
  const ahorroAnualTotal = ahorro * 12;

  ahorroMensual.value = ahorro.toFixed(2);
  ahorroAnual.value = ahorroAnualTotal.toFixed(2);

  const porcentaje = gastoActual > 0 ? (ahorro / gastoActual) * 100 : 0;
  porcentajeAhorro.textContent = `${porcentaje.toFixed(1)}%`;
}

// Escucha los cambios en todos los inputs existentes o nuevos
tablaAhorro.addEventListener("input", actualizarAhorro);

// --- BOT√ìN AGREGAR FILA ---
document.getElementById("agregarAhorro").addEventListener("click", () => {
  const fila = document.createElement("tr");
  fila.innerHTML = `
    <td><input type="text" placeholder="Servicio..."></td>
    <td><input type="number" class="gastoActual" step="0.01" placeholder="0.00"></td>
    <td><input type="text" placeholder="Nuevo servicio..."></td>
    <td><input type="number" class="nuevoGasto" step="0.01" placeholder="0.00"></td>`;
  tablaAhorro.appendChild(fila);

  // Asegurar que las nuevas filas tambi√©n actualicen el ahorro
  fila.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", actualizarAhorro);
  });
});

// --- BOT√ìN ELIMINAR FILA ---
document.getElementById("eliminarAhorro").addEventListener("click", () => {
  const filas = tablaAhorro.querySelectorAll("tr");
  if (filas.length > 1) filas[filas.length - 1].remove();
  actualizarAhorro();
});

// --- ACTIVAR BUSCADOR DENTRO DE CADA SELECT DE SERVICIOS --- //
$(document).ready(function() {
  // Funci√≥n para aplicar Select2 a todos los selects existentes
  function activarSelect2() {
    $('.servicioSelect').select2({
      placeholder: "-- Selecciona un servicio --",
      width: '100%',
      language: {
        noResults: function() {
          return "Sin coincidencias";
        }
      }
    });
  }

  // Activar al cargar la p√°gina
  activarSelect2();

  // Reaplicar autom√°ticamente cuando se agreguen nuevas filas
  const observer = new MutationObserver(() => activarSelect2());
  observer.observe(document.querySelector("#tablaServicios tbody"), { childList: true });
});
// --- CONTROL DE BOTONES FINALES ---
// ‚úÖ Verificar cantidades antes de enviar o cambiar de vista

function verificarAntesDeAccion(e) {
  let valido = true;

  document.querySelectorAll("#tablaServicios tbody tr").forEach(fila => {
    const select = fila.querySelector(".servicioSelect");
    const personalizado = fila.querySelector(".servicioPersonalizado");
    const cantidad = fila.querySelector(".cantidad");

    // limpiar cualquier mensaje anterior
    cantidad.setCustomValidity("");

    // detectar si hay un servicio seleccionado o escrito
    const tieneServicio =
      (select && select.value !== "") ||
      (personalizado && personalizado.value.trim() !== "");

    // ‚úÖ Solo validar cantidad si hay servicio elegido
    if (tieneServicio) {
      if (cantidad.value.trim() === "" || parseFloat(cantidad.value) <= 0) {
        cantidad.setCustomValidity("Por favor, introduce una cantidad v√°lida");
        cantidad.reportValidity();
        cantidad.focus();
        valido = false;
      }
    } else {
      // si no hay servicio, no se valida nada
      cantidad.setCustomValidity("");
    }
  });

  return valido;
}

const comentarios = document.getElementById("comentariosRevision");
const btnRevisar = document.getElementById("revisarOferta");
const btnRechazar = document.getElementById("rechazarOferta");
const btnAceptar = document.getElementById("aceptarOferta");


// Solo habilitar "Revisar" si hay texto
comentarios.addEventListener("input", () => {
  const hayTexto = comentarios.value.trim().length > 0;
  btnRevisar.disabled = !hayTexto;
});

// --- Detectar si estamos en GitHub Pages o local ---
const isGithub = window.location.hostname.includes("github.io");
const basePath = isGithub ? "/prueba/" : "./";

// --- BOTONES FINALES CON VALIDACI√ìN DE CANTIDADES ---

// ‚úÖ Aceptar oferta
btnAceptar.addEventListener("click", (e) => {
  if (!verificarAntesDeAccion(e)) return;  // Verifica antes de continuar
  e.preventDefault();
  window.location.href = `${basePath}resultado.html?estado=aceptada`;
});

// üîç Revisar oferta
btnRevisar.addEventListener("click", (e) => {
  if (!verificarAntesDeAccion(e)) return;  // Verifica antes de continuar
  e.preventDefault();
  const texto = comentarios.value.trim();
  if (texto) {
    window.location.href = `${basePath}resultado.html?estado=revisar`;
  }
});

// ‚ùå Rechazar oferta
btnRechazar.addEventListener("click", (e) => {
  if (!verificarAntesDeAccion(e)) return;  // Verifica antes de continuar
  e.preventDefault();
  window.location.href = `${basePath}resultado.html?estado=rechazada`;
});


// NUEVO: vista cliente
const btnVistaCliente = document.createElement("button");
btnVistaCliente.textContent = "üëÅÔ∏è Vista Cliente";
btnVistaCliente.className = "btn-final azul";
document.querySelector(".botones-finales").appendChild(btnVistaCliente);

// --- GUARDAR OFERTA EN LOCALSTORAGE Y ABRIR VISTA CLIENTE ---
btnVistaCliente.addEventListener("click", (e) => {
  if (!verificarAntesDeAccion(e)) return;  // ‚ö†Ô∏è Verifica cantidades antes de continuar
  e.preventDefault();

  // Crear objeto con los datos del formulario
  const datos = {
    fecha: document.getElementById("fechaOferta").value,
    empresa: document.getElementById("nombreEmpresa")?.value || "",
    comercial: {
      nombre: document.querySelector('.comercial-info input[placeholder="Escribe el nombre..."]')?.value || "",
      movil: document.querySelector('.comercial-info input[placeholder="Ej: 600 123 456"]')?.value || "",
      email: document.querySelector('.comercial-info input[placeholder="nombre@empresa.com"]')?.value || "",
      fijo: document.querySelector('.comercial-info input[placeholder="91 088 50 50"]')?.value || ""
    },
    observaciones: document.querySelector(".observaciones-box textarea")?.value || "",
    totalMensualIVA: document.getElementById("mensualIVA")?.value || "",
    instalacionIVA: document.getElementById("instalacionIVA")?.value || "",
    mostrarComparativa: document.getElementById("mostrarComparativa").checked,
    servicios: []
  };

  // Guardar lista de servicios
  document.querySelectorAll("#tablaServicios tbody tr").forEach(tr => {
    const servicio =
      tr.querySelector(".servicioSelect")?.selectedOptions[0]?.text ||
      tr.querySelector(".servicioPersonalizado")?.value ||
      "";
    const cantidad = tr.querySelector(".cantidad")?.value || "";
    const coste = tr.querySelector(".coste")?.value || "";
    if (servicio) datos.servicios.push({ servicio, cantidad, coste });
  });

  // ‚úÖ Guardar datos de la comparativa de ahorro
  const comparativaFilas = document.querySelectorAll("#tablaAhorro tbody tr");
  datos.comparativa = [];

  comparativaFilas.forEach(tr => {
    const servicioActual = tr.querySelector("td:nth-child(1) input")?.value || "";
    const gastoActual = tr.querySelector(".gastoActual")?.value || "";
    const nuevoServicio = tr.querySelector("td:nth-child(3) input")?.value || "";
    const nuevoGasto = tr.querySelector(".nuevoGasto")?.value || "";

    if (servicioActual || nuevoServicio) {
      datos.comparativa.push({
        servicioActual,
        gastoActual,
        nuevoServicio,
        nuevoGasto
      });
    }
  });

  // ‚úÖ Guardar totales de ahorro
  datos.ahorroMensual = document.getElementById("ahorroMensual")?.value || "";
  datos.ahorroAnual = document.getElementById("ahorroAnual")?.value || "";
  datos.porcentajeAhorro = document.getElementById("porcentajeAhorro")?.textContent || "";

  // Guardar en localStorage y abrir la vista cliente
  localStorage.setItem("ofertaTelekos", JSON.stringify(datos));
  window.open("propuesta-cliente.html", "_blank");
});



// üî† Convertir autom√°ticamente a MAY√öSCULAS el campo "Nombre de la empresa"
const campoNombreEmpresa = document.getElementById("nombreEmpresa");
if (campoNombreEmpresa) {
  campoNombreEmpresa.addEventListener("input", (e) => {
    e.target.value = e.target.value.toUpperCase();
  });
}

// üö® Validar que TODAS las cantidades est√©n rellenas antes de calcular
function validarCantidades() {
  let valido = true;

  tabla.querySelectorAll(".cantidad").forEach(input => {
    if (input.value.trim() === "" || parseFloat(input.value) <= 0) {
      valido = false;
      input.style.border = "2px solid #f58220"; // borde naranja de aviso
      input.style.backgroundColor = "#fff4ec";  // fondo crema
    } else {
      input.style.border = "1px solid #cdd5df"; // normal
      input.style.backgroundColor = "white";
    }
  });

  return valido;
}

// üö® Si alguien borra una cantidad, la marca en naranja y no deja calcular
function validarCantidades() {
  let valido = true;

  tabla.querySelectorAll(".cantidad").forEach(input => {
    if (input.value.trim() === "" || parseFloat(input.value) <= 0) {
      valido = false;
      input.style.border = "2px solid #f58220";
      input.style.backgroundColor = "#fff4ec";
    } else {
      input.style.border = "1px solid #cdd5df";
      input.style.backgroundColor = "white";
    }
  });

  return valido;
}



  </script>
</body>
</html>
